Implementation originally written in Python 2.7